 SUBROUTINE modul6(cep,t11,t12,t21,t22,def,spc)
 ! modify modulus for large strain formulation
 IMPLICIT NONE
 REAL (kind=8) cep(8,8),t11,t12,t21,t22,def,spc

 REAL (kind=8) l1111, l2121, l1121, l1212, l2222, l1222, l1112,    &
&              l2122, l1122, l1221, l11d, l21d, l12d, l22d,        &
&            d11, d12, d13, d14, d15, d16, d17, d18, d22, d23, d24,&
&            d25, d26, d27, d28, d33, d34, d35, d36, d37, d38, d44,&
&            d45, d46, d47, d48, d55, d56, d57, d58, d66, d67, d68,&
&            d77, d78, d88


 !   la matriz m1 es lambda^(-1)
 !m1:=mat((t11**2 ,t21**2 ,t11*t21 ,t11*t21 , 0, 0, 0, 0, 0),
 !        (t12**2 ,t22**2 ,t12*t22 ,t12*t22 , 0, 0, 0, 0, 0),
 !        (t11*t12,t21*t22,t11*t22 ,t12*t21 , 0, 0, 0, 0, 0),
 !        (t11*t12,t21*t22,t12*t21 ,t11*t22 , 0, 0, 0, 0, 0),
 !        ( 0, 0, 0, 0,t11**2 ,t21**2 ,t11*t21 ,t11*t21 , 0, 0),
 !        ( 0, 0, 0, 0,t12**2 ,t22**2 ,t12*t22 ,t12*t22 , 0, 0),
 !        ( 0, 0, 0, 0,t11*t12,t21*t22,t11*t22 ,t12*t21 , 0, 0),
 !        ( 0, 0, 0, 0,t11*t12,t21*t22,t12*t21 ,t11*t22 , 0, 0),
 !        ( 0, 0, 0, 0, 0, 0, 0, 0,t11/def,t21/def),
 !        ( 0, 0, 0, 0, 0, 0, 0, 0,t12/def,t22/def));
 !m1:=mat((l1111 ,l2121 ,l1121 ,l1121, 0, 0, 0, 0, 0, 0),
 !        (l1212 ,l2222 ,l1222 ,l1222, 0, 0, 0, 0, 0, 0),
 !        (l1112 ,l2122 ,l1122 ,l1221, 0, 0, 0, 0, 0, 0),
 !        (l1112 ,l2122 ,l1221 ,l1122, 0, 0, 0, 0, 0, 0),
 !        ( 0, 0, 0, 0,l1111 ,l2121 ,l1121 ,l1121, 0, 0),
 !        ( 0, 0, 0, 0,l1212 ,l2222 ,l1222 ,l1222, 0, 0),
 !        ( 0, 0, 0, 0,l1112 ,l2122 ,l1122 ,l1221, 0, 0),
 !        ( 0, 0, 0, 0,l1112 ,l2122 ,l1221 ,l1122, 0, 0),
 !        ( 0, 0, 0, 0, 0, 0, 0, 0,l11d ,l21d),
 !        ( 0, 0, 0, 0, 0, 0, 0, 0,l12d ,l22d))$

  l1111 = t11*t11
  l2121 = t21*t21
  l1121 = t11*t21
  l1212 = t12*t12
  l2222 = t22*t22
  l1222 = t12*t22
  l1112 = t11*t12
  l2122 = t21*t22
  l1122 = t11*t22
  l1221 = t12*t21
  l11d  = t11/def
  l21d  = t21/def
  l12d  = t12/def
  l22d  = t22/def

 !  dep:=mat((d11,d12,d13,d13,d14,d15,d16,d16,d17,d18),
 !           (d12,d22,d23,d23,d24,d25,d26,d26,d27,d28),
 !           (d13,d23,d33,d33,d34,d35,d36,d36,d37,d38),
 !           (d13,d23,d33,d33,d34,d35,d36,d36,d37,d38),
 !           (d14,d24,d34,d34,d44,d45,d46,d46,d47,d48),
 !           (d15,d25,d35,d35,d45,d55,d56,d56,d57,d58),
 !           (d16,d26,d36,d36,d46,d56,d66,d66,d67,d68),
 !           (d16,d26,d36,d36,d46,d56,d66,d66,d67,d68),
 !           (d17,d27,d37,d37,d47,d57,d67,d67,d77,d78),
 !           (d18,d28,d38,d38,d48,d58,d68,d68,d78,d88))$

 !       cep:= m1*dep*tp(m1);

 IF(spc > 0) THEN

   d11 = cep(1,1)
   d12 = cep(2,1)
   d13 = cep(3,1)
   d14 = cep(4,1)
   d15 = cep(5,1)
   d16 = cep(6,1)
   d17 = cep(7,1)
   d18 = cep(8,1)
   d22 = cep(2,2)
   d23 = cep(3,2)
   d24 = cep(4,2)
   d25 = cep(5,2)
   d26 = cep(6,2)
   d27 = cep(7,2)
   d28 = cep(8,2)
   d33 = cep(3,3)
   d34 = cep(4,3)
   d35 = cep(5,3)
   d36 = cep(6,3)
   d37 = cep(7,3)
   d38 = cep(8,3)
   d44 = cep(4,4)
   d45 = cep(5,4)
   d46 = cep(6,4)
   d47 = cep(7,4)
   d48 = cep(8,4)
   d55 = cep(5,5)
   d56 = cep(6,5)
   d57 = cep(7,5)
   d58 = cep(8,5)
   d66 = cep(6,6)
   d67 = cep(7,6)
   d68 = cep(8,6)
   d77 = cep(7,7)
   d78 = cep(8,7)
   d88 = cep(8,8)


   cep(1,1) = d11*l1111**2+2*d12*l1111*l2121+4*d13*l1111*l1121+    &
&             d22*l2121**2+4*d23*l2121*l1121+4*d33*l1121**2

   cep(2,1) = d11*l1111*l1212+d12*(l1111*l2222+l2121*l1212)+d13*(  &
&             2*l1111*l1222+2*l1121*l1212)+d22*l2121*l2222+        &
&             d23*(2*l2121* l1222+2*l1121*l2222)+4*d33*l1121*l1222

   cep(2,2) = d11*l1212**2+2*d12*l1212*l2222+4*d13*l1212*l1222+    &
&             d22*l2222**2+4*d23*l1222*l2222+4*d33*l1222**2

   cep(3,1) = d11*l1111*l1112+d12*(l1111*l2122+l2121*l1112)+d13*(  &
&             l1111*l1122+l1111*l1221+2*l1121*l1112)+              &
&             d22*l2121*l2122+d23 *(l2121*l1122+l2121*l1221+       &
&             2*l1121*l2122)+d33*(2*l1121*l1122+2 *l1121*l1221)

   cep(3,2) = d11*l1212*l1112+d12*(l1212*l2122+l1112*l2222)+d13*(  &
&             l1212*l1122+l1212*l1221+2*l1222*l1112)+              &
&             d22*l2122*l2222+d23 *(2*l1222*l2122+l1122*l2222+     &
&             l1221*l2222)+d33*(2*l1222*l1122+2 *l1222*l1221)

   cep(3,3) = d11*l1112**2+2*d12*l1112*l2122+d13*(2*l1112*l1122+2  &
&             *l1112*l1221)+d22*l2122**2+d23*(2*l2122*l1122+       &
&             2*l2122*l1221) +d33*(l1122**2+2*l1122*l1221+         &
&             l1221**2)

   cep(4,1) = d14*l1111**2+d15*l1111*l2121+2*d16*l1111*l1121+d24*  &
&             l1111*l2121+d25*l2121**2+2*d26*l2121*l1121+          &
&             2*d34*l1111*l1121+2*d35*l2121*l1121+4*d36*l1121**2

   cep(4,2) = d14*l1111*l1212+d15*l2121*l1212+2*d16*l1121*l1212+   &
&             d24*l1111*l2222+d25*l2121*l2222+2*d26*l1121*l2222+   &
&             2*d34*l1111* l1222+2*d35*l2121*l1222+                &
&             4*d36*l1121*l1222

   cep(4,3) = d14*l1111*l1112+d15*l2121*l1112+2*d16*l1121*l1112+   &
&             d24*l1111*l2122+d25*l2121*l2122+2*d26*l1121*l2122+   &
&             d34*(l1111* l1122+l1111*l1221)+d35*(l2121*l1122+     &
&             l2121*l1221)+d36*(2* l1121*l1122+2*l1121*l1221)

   cep(4,4) = d44*l1111**2+2*d45*l1111*l2121+4*d46*l1111*l1121+    &
&             d55*l2121**2+4*d56*l2121*l1121+4*d66*l1121**2

   cep(5,1) = d14*l1111*l1212+d15*l1111*l2222+2*d16*l1111*l1222+   &
&             d24*l2121*l1212+d25*l2121*l2222+2*d26*l2121*l1222+   &
&             2*d34*l1121* l1212+2*d35*l1121*l2222+                &
&             4*d36*l1121*l1222

   cep(5,2) = d14*l1212**2+d15*l1212*l2222+2*d16*l1212*l1222+d24*  &
&             l1212*l2222+d25*l2222**2+2*d26*l1222*l2222+          &
&             2*d34*l1212*l1222+2*d35*l1222*l2222+4*d36*l1222**2

   cep(5,3) = d14*l1212*l1112+d15*l1112*l2222+2*d16*l1222*l1112+   &
&             d24*l1212*l2122+d25*l2122*l2222+2*d26*l1222*l2122+   &
&             d34*(l1212* l1122+l1212*l1221)+d35*(l1122*l2222+     &
&             l1221*l2222)+d36*(2* l1222*l1122+2*l1222*l1221)

   cep(5,4) = d44*l1111*l1212+d45*(l1111*l2222+l2121*l1212)+d46*(  &
&             2*l1111*l1222+2*l1121*l1212)+d55*l2121*l2222+        &
&             d56*(2*l2121* l1222+2*l1121*l2222)+4*d66*l1121*l1222

   cep(5,5) = d44*l1212**2+2*d45*l1212*l2222+4*d46*l1212*l1222+    &
&             d55*l2222**2+4*d56*l1222*l2222+4*d66*l1222**2

   cep(6,1) = d14*l1111*l1112+d15*l1111*l2122+d16*(l1111*l1122+    &
&             l1111*l1221)+d24*l2121*l1112+d25*l2121*l2122+        &
&             d26*(l2121* l1122+l2121*l1221)+2*d34*l1121*l1112+    &
&             2*d35*l1121*l2122+d36 *(2*l1121*l1122+2*l1121*l1221)

   cep(6,2) = d14*l1212*l1112+d15*l1212*l2122+d16*(l1212*l1122+    &
&             l1212*l1221)+d24*l1112*l2222+d25*l2122*l2222+        &
&             d26*(l1122* l2222+l1221*l2222)+2*d34*l1222*l1112+    &
&             2*d35*l1222*l2122+d36 *(2*l1222*l1122+2*l1222*l1221)

   cep(6,3) = d14*l1112**2+d15*l1112*l2122+d16*(l1112*l1122+l1112  &
&             *l1221)+d24*l1112*l2122+d25*l2122**2+                &
&             d26*(l2122*l1122+l2122*l1221)+d34*(l1112*l1122+      &
&             l1112*l1221)+d35*(l2122*l1122 +l2122*l1221)+         &
&             d36*(l1122**2+2*l1122*l1221+l1221**2)

   cep(6,4) = d44*l1111*l1112+d45*(l1111*l2122+l2121*l1112)+d46*(  &
&             l1111*l1122+l1111*l1221+2*l1121*l1112)+              &
&             d55*l2121*l2122+d56 *(l2121*l1122+l2121*l1221+       &
&             2*l1121*l2122)+d66*(2*l1121*l1122+2 *l1121*l1221)

   cep(6,5) = d44*l1212*l1112+d45*(l1212*l2122+l1112*l2222)+d46*(  &
&             l1212*l1122+l1212*l1221+2*l1222*l1112)+              &
&             d55*l2122*l2222+d56 *(2*l1222*l2122+l1122*l2222+     &
&             l1221*l2222)+d66*(2*l1222*l1122+2 *l1222*l1221)

   cep(6,6) = d44*l1112**2+2*d45*l1112*l2122+d46*(2*l1112*l1122+2  &
&             *l1112*l1221)+d55*l2122**2+d56*(2*l2122*l1122+       &
&             2*l2122*l1221) +d66*(l1122**2+2*l1122*l1221+         &
&             l1221**2)

   cep(7,1) = d17*l1111*l11d+d18*l1111*l21d+d27*l2121*l11d+d28*    &
&             l2121*l21d+2*d37*l1121*l11d+2*d38*l1121*l21d

   cep(7,2) = d17*l1212*l11d+d18*l1212*l21d+d27*l2222*l11d+d28*    &
&             l2222*l21d+2*d37*l1222*l11d+2*d38*l1222*l21d

   cep(7,3) = d17*l1112*l11d+d18*l1112*l21d+d27*l2122*l11d+d28*    &
&             l2122*l21d+d37*(l1122*l11d+l1221*l11d)+              &
&             d38*(l1122*l21d+l1221* l21d)

   cep(7,4) = d47*l1111*l11d+d48*l1111*l21d+d57*l2121*l11d+d58*    &
&             l2121*l21d+2*d67*l1121*l11d+2*d68*l1121*l21d

   cep(7,5) = d47*l1212*l11d+d48*l1212*l21d+d57*l2222*l11d+d58*    &
&             l2222*l21d+2*d67*l1222*l11d+2*d68*l1222*l21d

   cep(7,6) = d47*l1112*l11d+d48*l1112*l21d+d57*l2122*l11d+d58*    &
&             l2122*l21d+d67*(l1122*l11d+l1221*l11d)+              &
&             d68*(l1122*l21d+l1221* l21d)

   cep(7,7) = d77*l11d**2+2*d78*l11d*l21d+d88*l21d**2

   cep(8,1) = d17*l1111*l12d+d18*l1111*l22d+d27*l2121*l12d+d28*    &
&             l2121*l22d+2*d37*l1121*l12d+2*d38*l1121*l22d

   cep(8,2) = d17*l1212*l12d+d18*l1212*l22d+d27*l2222*l12d+d28*    &
&             l2222*l22d+2*d37*l1222*l12d+2*d38*l1222*l22d

   cep(8,3) = d17*l1112*l12d+d18*l1112*l22d+d27*l2122*l12d+d28*    &
&             l2122*l22d+d37*(l1122*l12d+l1221*l12d)+              &
&             d38*(l1122*l22d+l1221* l22d)

   cep(8,4) = d47*l1111*l12d+d48*l1111*l22d+d57*l2121*l12d+d58*    &
&             l2121*l22d+2*d67*l1121*l12d+2*d68*l1121*l22d

   cep(8,5) = d47*l1212*l12d+d48*l1212*l22d+d57*l2222*l12d+d58*    &
&             l2222*l22d+2*d67*l1222*l12d+2*d68*l1222*l22d

   cep(8,6) = d47*l1112*l12d+d48*l1112*l22d+d57*l2122*l12d+d58*    &
&             l2122*l22d+d67*(l1122*l12d+l1221*l12d)+              &
&             d68*(l1122*l22d+l1221* l22d)

   cep(8,7) = d77*l11d*l12d+d78*(l11d*l22d+l21d*l12d)+d88*l21d*    &
&             l22d

   cep(8,8) = d77*l12d**2+2*d78*l12d*l22d+d88*l22d**2

 ELSE

   d11 = cep(1,1)
   d12 = cep(2,1)
   d22 = cep(2,2)
   d33 = cep(3,3)
   d44 = cep(4,4)
   d45 = cep(5,4)
   d55 = cep(5,5)
   d66 = cep(6,6)
   d77 = cep(7,7)
   d88 = cep(8,8)


   cep(1,1) = d11*l1111**2+2*d12*l1111*l2121+                      &
&             d22*l2121**2+4*d33*l1121**2

   cep(2,1) = d11*l1111*l1212+d12*(l1111*l2222+l2121*l1212)+       &
&             d22*l2121*l2222+4*d33*l1121*l1222

   cep(2,2) = d11*l1212**2+2*d12*l1212*l2222+                      &
&             d22*l2222**2+4*d33*l1222**2

   cep(3,1) = d11*l1111*l1112+d12*(l1111*l2122+l2121*l1112)+       &
&             d22*l2121*l2122+d33*(2*l1121*l1122+2*l1121*l1221)

   cep(3,2) = d11*l1212*l1112+d12*(l1212*l2122+l1112*l2222)+       &
&             d22*l2122*l2222+d33*(2*l1222*l1122+2 *l1222*l1221)

   cep(3,3) = d11*l1112**2+2*d12*l1112*l2122+d22*l2122**2          &
&             +d33*(l1122**2+2*l1122*l1221+l1221**2)

   cep(4,1) = 0d0
   cep(4,2) = 0d0
   cep(4,3) = 0d0

   cep(4,4) = d44*l1111**2+2*d45*l1111*l2121+                      &
&             d55*l2121**2+4*d66*l1121**2

   cep(5,1) = 0d0
   cep(5,2) = 0d0
   cep(5,3) = 0d0

   cep(5,4) = d44*l1111*l1212+d45*(l1111*l2222+l2121*l1212)+       &
&             d55*l2121*l2222+4*d66*l1121*l1222

   cep(5,5) = d44*l1212**2+2*d45*l1212*l2222+                      &
&             d55*l2222**2+4*d66*l1222**2

   cep(6,1) = 0d0
   cep(6,2) = 0d0
   cep(6,3) = 0d0

   cep(6,4) = d44*l1111*l1112+d45*(l1111*l2122+l2121*l1112)+       &
&             d55*l2121*l2122+d66*(2*l1121*l1122+2*l1121*l1221)

   cep(6,5) = d44*l1212*l1112+d45*(l1212*l2122+l1112*l2222)+       &
&             d55*l2122*l2222+d66*(2*l1222*l1122+2 *l1222*l1221)

   cep(6,6) = d44*l1112**2+2*d45*l1112*l2122+                      &
&             d55*l2122**2+d66*(l1122**2+2*l1122*l1221+l1221**2)

   cep(7,1) = 0d0
   cep(7,2) = 0d0
   cep(7,3) = 0d0
   cep(7,4) = 0d0
   cep(7,5) = 0d0
   cep(7,6) = 0d0

   cep(7,7) = d77*l11d**2+d88*l21d**2

   cep(8,1) = 0d0
   cep(8,2) = 0d0
   cep(8,3) = 0d0
   cep(8,4) = 0d0
   cep(8,5) = 0d0
   cep(8,6) = 0d0

   cep(8,7) = d77*l11d*l12d+d88*l21d*l22d

   cep(8,8) = d77*l12d**2+d88*l22d**2

 END IF

 END SUBROUTINE modul6
